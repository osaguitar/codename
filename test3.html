<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>„Ç≥„Éº„ÉâÈÄ≤Ë°å„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 20px 15px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 300;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .controls {
            padding: 20px 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .key-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .select-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            min-width: 120px;
        }

        .select-group label {
            font-weight: 500;
            color: #333;
            font-size: 0.85rem;
            text-align: center;
        }

        select {
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        select:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.15);
        }

        .content {
            padding: 15px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            margin-bottom: 20px;
            border-radius: 12px;
        }

        .stat {
            text-align: center;
            padding: 10px;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2196F3;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 0.75rem;
            margin-top: 4px;
        }

        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding: 0 5px;
        }

        .filter-tab {
            flex: 1;
            padding: 12px 8px;
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .filter-tab.active {
            background: #2196F3;
            color: white;
        }

        .progressions-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .progression-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .progression-card:active {
            transform: scale(0.98);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .progression-card.expanded {
            background: #f8f9fa;
            border-color: #2196F3;
        }

        .progression-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .progression-type {
            background: #2196F3;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .chords-container {
            margin-bottom: 12px;
        }

        .chords {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 8px;
            margin-bottom: 8px;
        }

        .chord {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 8px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            text-align: center;
            touch-action: manipulation;
        }

        .roman-numerals {
            color: #888;
            font-size: 0.75rem;
            text-align: center;
            font-style: italic;
        }

        .description {
            color: #666;
            font-size: 0.85rem;
            line-height: 1.4;
            margin-top: 10px;
            display: none;
        }

        .progression-card.expanded .description {
            display: block;
        }

        .expand-indicator {
            font-size: 0.8rem;
            color: #888;
            transition: transform 0.3s ease;
        }

        .progression-card.expanded .expand-indicator {
            transform: rotate(180deg);
        }

        .floating-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .floating-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #2196F3;
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .floating-btn:active {
            transform: scale(0.9);
        }

        .back-to-top {
            background: #666;
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .controls {
                padding: 15px 10px;
            }

            .content {
                padding: 10px;
            }

            .stats {
                padding: 10px;
                gap: 8px;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .chord {
                padding: 10px 6px;
                font-size: 0.8rem;
            }

            .floating-controls {
                bottom: 15px;
                right: 15px;
            }

            .floating-btn {
                width: 48px;
                height: 48px;
                font-size: 1rem;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 800px;
            }

            .progressions-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .chords {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            }
        }

        @media (min-width: 1024px) {
            body {
                padding: 20px;
            }

            .container {
                max-width: 1200px;
            }

            .controls {
                padding: 30px;
            }

            .content {
                padding: 30px;
            }
        }

        /* „Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„ÇπÁî®„ÅÆË™øÊï¥ */
        @media (hover: none) and (pointer: coarse) {
            .progression-card:hover {
                transform: none;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéµ „Ç≥„Éº„ÉâÈÄ≤Ë°å„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº</h1>
            <p>„Çø„ÉÉ„Éó„Åó„Å¶„Ç≠„Éº„ÇíÈÅ∏Êäû„ÄÅÈÄ≤Ë°å„ÇíÊé¢Á¥¢„Åó„Çà„ÅÜ</p>
        </div>

        <div class="controls">
            <div class="key-selector">
                <div class="select-group">
                    <label for="key">„Ç≠„Éº</label>
                    <select id="key">
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>
                </div>
                <div class="select-group">
                    <label for="mode">„Çπ„Ç±„Éº„É´</label>
                    <select id="mode">
                        <option value="major">„É°„Ç∏„É£„Éº</option>
                        <option value="minor">„Éû„Ç§„Éä„Éº</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="totalProgressions">0</div>
                    <div class="stat-label">„Ç≥„Éº„ÉâÈÄ≤Ë°å</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="basicCount">0</div>
                    <div class="stat-label">Âü∫Êú¨ÈÄ≤Ë°å</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="advancedCount">0</div>
                    <div class="stat-label">ÂøúÁî®ÈÄ≤Ë°å</div>
                </div>
            </div>

            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">„Åô„Åπ„Å¶</button>
                <button class="filter-tab" data-filter="basic">Âü∫Êú¨</button>
                <button class="filter-tab" data-filter="advanced">ÂøúÁî®</button>
            </div>

            <div class="progressions-grid" id="progressionsGrid">
                <!-- „Ç≥„Éº„ÉâÈÄ≤Ë°å„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
            </div>
        </div>
    </div>

    <div class="floating-controls">
        <button class="floating-btn back-to-top" id="backToTop" title="„Éà„ÉÉ„Éó„Å´Êàª„Çã">‚Üë</button>
        <button class="floating-btn" id="randomProgression" title="„É©„É≥„ÉÄ„É†ÈÅ∏Êäû">üé≤</button>
    </div>

    <script>
        class ChordProgressionGenerator {
            constructor() {
                this.keyElement = document.getElementById('key');
                this.modeElement = document.getElementById('mode');
                this.gridElement = document.getElementById('progressionsGrid');
                this.currentFilter = 'all';

                this.progressions = {
                    basic: [
                        { name: '„Ç´„Éé„É≥ÈÄ≤Ë°å', chords: ['I', 'V', 'vi', 'iii', 'IV', 'I', 'IV', 'V'], description: 'ÊúÄ„ÇÇÊúâÂêç„ÅßÁæé„Åó„ÅÑ„Ç≥„Éº„ÉâÈÄ≤Ë°å„ÄÇ„Éë„ÉÉ„Éò„É´„Éô„É´„ÅÆ„Ç´„Éé„É≥„ÅßÁü•„Çâ„Çå„ÄÅÂ§ö„Åè„ÅÆ„Éí„ÉÉ„ÉàÊõ≤„Åß‰ΩøÁî®„Åï„Çå„Çã„ÄÇÊÑüÂãïÁöÑ„ÅßÊôÆÈÅçÁöÑ„Å™Èüø„Åç„ÇíÊåÅ„Å§„ÄÇ' },
                        { name: '‰∏∏„ÇµÈÄ≤Ë°å', chords: ['IM7', 'vi7', 'ii7', 'V7'], description: '„Ç∏„É£„Ç∫„Çπ„Çø„É≥„ÉÄ„Éº„Éâ„ÅÆÂü∫Êú¨„ÄÇÂæ™Áí∞„Ç≥„Éº„Éâ„Å®„Åó„Å¶„ÇÇÁü•„Çâ„Çå„ÄÅÁÑ°Èôê„Å´„É´„Éº„Éó„Åß„Åç„ÇãÁæé„Åó„ÅÑÈÄ≤Ë°å„ÄÇ' },
                        { name: '4536ÈÄ≤Ë°å', chords: ['IV', 'V', 'iii', 'vi'], description: 'J-POP„ÅßÈùûÂ∏∏„Å´Â§öÁî®„Åï„Çå„ÇãÈªÑÈáë„Éë„Çø„Éº„É≥„ÄÇÊòé„Çã„ÅèË¶™„Åó„Åø„ÇÑ„Åô„ÅÑÈüø„Åç„ÅåÁâπÂæ¥„ÄÇ' },
                        { name: '6451ÈÄ≤Ë°å', chords: ['vi', 'IV', 'V', 'I'], description: '„Éù„ÉÉ„Éó„Çπ„ÅÆÂÆöÁï™„ÄÇÊÑüÊÉÖÁöÑ„ÅßÂàá„Å™„ÅÑÈüø„Åç„ÅåÁâπÂæ¥„ÄÇ„Éê„É©„Éº„Éâ„Åß„Çà„Åè‰ΩøÁî®„Åï„Çå„Çã„ÄÇ' },
                        { name: '1564ÈÄ≤Ë°å', chords: ['I', 'V', 'vi', 'IV'], description: 'Let It Be„ÅßÊúâÂêç„ÄÇÊ∏©„Åã„Åø„ÅÆ„ÅÇ„ÇãË¶™„Åó„Åø„ÇÑ„Åô„ÅÑÈÄ≤Ë°å„ÄÇ' },
                        { name: 'ÁéãÈÅìÈÄ≤Ë°å', chords: ['VIM7', 'V7', 'IM7'], description: '„Éâ„Éü„Éä„É≥„Éà„É¢„Éº„Ç∑„Éß„É≥„ÅÆÂü∫Êú¨ÂΩ¢„ÄÇÂº∑„ÅÑËß£Ê±∫ÊÑü„ÇíÊåÅ„Å§„ÇØ„É©„Ç∑„Ç´„É´„Å™ÈÄ≤Ë°å„ÄÇ' },
                        { name: '„ÉÑ„Éº„Éï„Ç°„Ç§„Éñ„ÉØ„É≥', chords: ['ii7', 'V7', 'IM7'], description: '„Ç∏„É£„Ç∫„ÅÆÂü∫Á§é„ÄÇÂº∑„ÅÑËß£Ê±∫ÊÑü„ÇíÊåÅ„Å°„ÄÅ„ÅÇ„Çâ„ÇÜ„Çã„Ç∏„É£„É≥„É´„Åß‰ΩøÁî®„Åï„Çå„Çã„ÄÇ' },
                        { name: '‰∏ãÈôçÈÄ≤Ë°å', chords: ['I', 'VII', 'VI', 'V'], description: '„Éô„Éº„Çπ„É©„Ç§„É≥„ÅåÂçäÈü≥‰∏ãÈôç„Åô„ÇãÂäõÂº∑„ÅÑÈÄ≤Ë°å„ÄÇ„É≠„ÉÉ„ÇØ„Åß„Çà„Åè‰ΩøÁî®„Åï„Çå„Çã„ÄÇ' }
                    ],
                    advanced: [
                        { name: '„Ç´„Éé„É≥ÈÄ≤Ë°åÂ§âÂåñÂΩ¢A', chords: ['I', 'V', 'vi', 'iii', 'IV', 'I', 'ii', 'V'], description: '„Ç´„Éé„É≥ÈÄ≤Ë°å„ÅÆÂæåÂçä„ÇíÂ§âÂåñ„Åï„Åõ„ÅüÂøúÁî®ÂΩ¢„ÄÇ„Çà„ÇäËß£Ê±∫ÊÑü„ÅÆ„ÅÇ„ÇãÁµÇ„Çè„ÇäÊñπ„ÄÇ' },
                        { name: '„Ç´„Éé„É≥ÈÄ≤Ë°åÂ§âÂåñÂΩ¢B', chords: ['I', 'V', 'vi', 'IV', 'I', 'V', 'IV', 'V'], description: '3Â∞èÁØÄÁõÆ„ÇíÂ§âÊõ¥„Åó„ÅüÁèæ‰ª£ÁöÑ„Å™„Ç¢„É¨„É≥„Ç∏„ÄÇ„Éù„ÉÉ„Éó„ÇπÂêë„Åë„ÄÇ' },
                        { name: 'Êã°Âºµ4536ÈÄ≤Ë°å', chords: ['IV', 'V', 'iii', 'vi', 'ii', 'V', 'I'], description: '4536ÈÄ≤Ë°å„Å´Ëß£Ê±∫ÈÉ®ÂàÜ„ÇíËøΩÂä†„ÄÇ„Çà„ÇäÂÆåÁµêÊÑü„ÅÆ„ÅÇ„ÇãÂΩ¢„ÄÇ' },
                        { name: '„ÇØ„É™„Ç∑„ÇßÈÄ≤Ë°å', chords: ['I', 'I/VII', 'I/VI', 'I/V'], description: '„Éô„Éº„ÇπÈü≥„ÅåÂçäÈü≥„Åö„Å§‰∏ãÈôç„Åô„ÇãÊäÄÊ≥ï„ÄÇÊò†ÁîªÈü≥Ê•Ω„Åß„Çà„Åè‰ΩøÁî®„Åï„Çå„Çã„ÄÇ' },
                        { name: '„É¢„Éº„ÉÄ„É´ÈÄ≤Ë°å', chords: ['i', 'bVII', 'IV', 'i'], description: '„Éä„ÉÅ„É•„É©„É´„Éû„Ç§„Éä„Éº„ÅÆÁâπÂæ¥ÁöÑ„Å™ÈÄ≤Ë°å„ÄÇ„Ç®„Ç≠„Çæ„ÉÅ„ÉÉ„ÇØ„Å™Èüø„Åç„ÄÇ' },
                        { name: '„Çµ„Éñ„Éâ„Éü„Éä„É≥„ÉàÈÄ£Èéñ', chords: ['I', 'IV', 'bVII', 'IV'], description: '„Çµ„Éñ„Éâ„Éü„Éä„É≥„Éà„Çí‰∏≠ÂøÉ„Å®„Åó„ÅüÊµÆÈÅäÊÑü„ÅÆ„ÅÇ„ÇãÈÄ≤Ë°å„ÄÇ„Ç¢„É≥„Éì„Ç®„É≥„ÉàÁ≥ª„Åß‰∫∫Ê∞ó„ÄÇ' },
                        { name: '„Ç∏„É£„Ç∫„Çø„Éº„Éä„É©„Ç¶„É≥„Éâ', chords: ['IM7', 'vi7', 'ii7', 'V7', 'IM7'], description: '‰∏∏„ÇµÈÄ≤Ë°å„Å´Ëß£Ê±∫„ÇíËøΩÂä†„Åó„Åü„Ç∏„É£„Ç∫„ÅÆÂ∏∏Â•óÂè•„ÄÇ„Çª„ÉÉ„Ç∑„Éß„É≥„Åß„Çà„Åè‰ΩøÁî®„ÄÇ' },
                        { name: '„Éñ„É´„Éº„ÇπÈÄ≤Ë°åÔºàÁ∞°ÊòìÔºâ', chords: ['I7', 'IV7', 'I7', 'V7'], description: '12Â∞èÁØÄ„Éñ„É´„Éº„Çπ„ÅÆÁ∞°Áï•Áâà„ÄÇÂü∫Êú¨ÁöÑ„Å™„Éñ„É´„Éº„Çπ„ÅÆÈüø„Åç„ÇíÂ≠¶„Åπ„Çã„ÄÇ' },
                        { name: 'Ë£è„Ç≥„Éº„ÉâÈÄ≤Ë°å', chords: ['IM7', 'bII7', 'IM7'], description: 'V7„ÅÆ‰ª£ÁêÜ„Å®„Åó„Å¶‚ô≠II7„Çí‰ΩøÁî®„ÄÇ„Ç∏„É£„Ç∫„ÅÆÈ´òÂ∫¶„Å™„ÉÜ„ÇØ„Éã„ÉÉ„ÇØ„ÄÇ' },
                        { name: '„Éç„Ç™„ÇΩ„Ç¶„É´ÈÄ≤Ë°å', chords: ['ii√∏7', 'V7alt', 'i7'], description: 'Áèæ‰ª£R&B„Åß‰∫∫Ê∞ó„ÅÆÊ¥óÁ∑¥„Åï„Çå„ÅüÈüø„Åç„ÄÇË§áÈõë„Å†„ÅåÁæé„Åó„ÅÑ„Éè„Éº„É¢„Éã„Éº„ÄÇ' },
                        { name: '„É¢„Éº„ÉâÂ§âÂåñÈÄ≤Ë°å', chords: ['I', 'i', 'IV', 'iv'], description: '„É°„Ç∏„É£„Éº„Å®„Éû„Ç§„Éä„Éº„ÇíË°å„ÅçÊù•„Åô„ÇãÂç∞Ë±°ÁöÑ„Å™ÈÄ≤Ë°å„ÄÇÊÑüÊÉÖ„ÅÆËµ∑‰ºè„ÇíË°®Áèæ„ÄÇ' },
                        { name: '„Çª„Ç´„É≥„ÉÄ„É™„Éº„Éâ„Éü„Éä„É≥„Éà', chords: ['I', 'V/vi', 'vi', 'V'], description: 'vi„Å´Âêë„Åã„ÅÜ„Çª„Ç´„É≥„ÉÄ„É™„Éº„Éâ„Éü„Éä„É≥„Éà„Çí‰ΩøÁî®„ÄÇ„Éè„Éº„É¢„Éã„Éº„Å´Ëâ≤ÂΩ©ÊÑü„ÇíËøΩÂä†„ÄÇ' }
                    ]
                };

                this.scales = {
                    major: [0, 2, 4, 5, 7, 9, 11],
                    minor: [0, 2, 3, 5, 7, 8, 10]
                };

                this.chordQualities = {
                    major: ['M', 'm', 'm', 'M', 'M', 'm', 'dim'],
                    minor: ['m', 'dim', 'M', 'm', 'm', 'M', 'M']
                };

                this.noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

                this.init();
            }

            init() {
                this.keyElement.addEventListener('change', () => this.generateProgressions());
                this.modeElement.addEventListener('change', () => this.generateProgressions());

                // „Éï„Ç£„É´„Çø„Éº„Çø„Éñ
                document.querySelectorAll('.filter-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.filterProgressions();
                    });
                });

                // „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éú„Çø„É≥
                document.getElementById('backToTop').addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });

                document.getElementById('randomProgression').addEventListener('click', () => {
                    this.highlightRandomProgression();
                });

                this.generateProgressions();
            }

            parseChordSymbol(symbol, key, mode) {
                let degree, quality = '';

                if (symbol.includes('bVII')) {
                    degree = 7;
                    symbol = symbol.replace('bVII', '');
                    if (mode === 'major') degree = 7;
                } else if (symbol.includes('bVI')) {
                    degree = 6;
                    symbol = symbol.replace('bVI', '');
                } else if (symbol.includes('bII')) {
                    degree = 2;
                    symbol = symbol.replace('bII', '');
                } else if (symbol.includes('V/vi')) {
                    return this.noteNames[(this.noteNames.indexOf(key) + 9) % 12] + '7';
                } else {
                    const romanMatch = symbol.match(/(VII|VI|V|IV|III|II|I|vii|vi|v|iv|iii|ii|i)/);
                    if (romanMatch) {
                        const roman = romanMatch[1];
                        const romanToNum = {
                            'I': 1, 'II': 2, 'III': 3, 'IV': 4, 'V': 5, 'VI': 6, 'VII': 7,
                            'i': 1, 'ii': 2, 'iii': 3, 'iv': 4, 'v': 5, 'vi': 6, 'vii': 7
                        };
                        degree = romanToNum[roman];
                        symbol = symbol.replace(roman, '');
                    }
                }

                quality = symbol;
                return { degree, quality };
            }

            convertToActualChord(romanChord, key, mode) {
                const keyIndex = this.noteNames.indexOf(key);
                const scale = this.scales[mode];
                const qualities = this.chordQualities[mode];

                if (romanChord.includes('V/vi')) {
                    return this.noteNames[(keyIndex + 9) % 12] + '7';
                }

                const parsed = this.parseChordSymbol(romanChord, key, mode);
                let { degree, quality } = parsed;

                if (!degree) return romanChord;

                let noteIndex;
                if (romanChord.includes('bVII')) {
                    noteIndex = (keyIndex + 10) % 12;
                } else if (romanChord.includes('bVI')) {
                    noteIndex = (keyIndex + 8) % 12;
                } else if (romanChord.includes('bII')) {
                    noteIndex = (keyIndex + 1) % 12;
                } else {
                    noteIndex = (keyIndex + scale[degree - 1]) % 12;
                }

                const rootNote = this.noteNames[noteIndex];

                if (quality === '') {
                    quality = qualities[degree - 1] === 'M' ? '' : qualities[degree - 1];
                }

                return rootNote + quality;
            }

            generateProgressions() {
                const key = this.keyElement.value;
                const mode = this.modeElement.value;

                this.gridElement.innerHTML = '';

                let basicCount = 0;
                let advancedCount = 0;

                this.progressions.basic.forEach(progression => {
                    const actualChords = progression.chords.map(chord =>
                        this.convertToActualChord(chord, key, mode)
                    );
                    this.createProgressionCard(progression, actualChords, 'basic');
                    basicCount++;
                });

                this.progressions.advanced.forEach(progression => {
                    const actualChords = progression.chords.map(chord =>
                        this.convertToActualChord(chord, key, mode)
                    );
                    this.createProgressionCard(progression, actualChords, 'advanced');
                    advancedCount++;
                });

                document.getElementById('totalProgressions').textContent = basicCount + advancedCount;
                document.getElementById('basicCount').textContent = basicCount;
                document.getElementById('advancedCount').textContent = advancedCount;

                this.filterProgressions();
            }

            createProgressionCard(progression, actualChords, type) {
                const card = document.createElement('div');
                card.className = 'progression-card';
                card.dataset.type = type;

                const typeLabel = type === 'basic' ? 'Âü∫Êú¨' : 'ÂøúÁî®';
                const typeColor = type === 'basic' ? '#4CAF50' : '#FF9800';

                card.innerHTML = `
                    <div class="progression-title">
                        <span>${progression.name}</span>
                        <div>
                            <span class="progression-type" style="background: ${typeColor}">${typeLabel}</span>
                            <span class="expand-indicator">‚ñº</span>
                        </div>
                    </div>
                    <div class="chords-container">
                        <div class="chords">
                            ${actualChords.map(chord => `<span class="chord">${chord}</span>`).join('')}
                        </div>
                        <div class="roman-numerals">
                            ${progression.chords.join(' - ')}
                        </div>
                    </div>
                    <div class="description">
                        ${progression.description}
                    </div>
                `;

                // „Çø„ÉÉ„Éó„ÅßÂ±ïÈñã/Êäò„Çä„Åü„Åü„Åø
                card.addEventListener('click', () => {
                    card.classList.toggle('expanded');
                });

                this.gridElement.appendChild(card);
            }

            filterProgressions() {
                const cards = document.querySelectorAll('.progression-card');
                cards.forEach(card => {
                    if (this.currentFilter === 'all' || card.dataset.type === this.currentFilter) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            highlightRandomProgression() {
                const visibleCards = Array.from(document.querySelectorAll('.progression-card'))
                    .filter(card => card.style.display !== 'none');

                if (visibleCards.length > 0) {
                    const randomCard = visibleCards[Math.floor(Math.random() * visibleCards.length)];

                    // Ââç„ÅÆ„Éè„Ç§„É©„Ç§„Éà„ÇíÂâäÈô§
                    document.querySelectorAll('.progression-card').forEach(card => {
                        card.style.border = '';
                    });

                    // „É©„É≥„ÉÄ„É†„Ç´„Éº„Éâ„Çí„Éè„Ç§„É©„Ç§„Éà
                    randomCard.style.border = '3px solid #FF6B6B';
                    randomCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                    // 3ÁßíÂæå„Å´„Éè„Ç§„É©„Ç§„Éà„ÇíÂâäÈô§
                    setTimeout(() => {
                        randomCard.style.border = '';
                    }, 3000);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new ChordProgressionGenerator();
        });
    </script>
</body>

</html>